---
/**
 * VolumeConverter Component
 * Converts US volume measurements (cups, tbsp, tsp) to grams
 */
import { VOLUME_CONVERSIONS, getAllIngredients } from '../../scripts/features/volumeConverter.js';

const ingredients = getAllIngredients();
const flourIngredients = ingredients.filter(i => i.id.includes('Flour') || i.id.includes('flour'));
const otherIngredients = ingredients.filter(i => !i.id.includes('Flour') && !i.id.includes('flour'));
---

<div class="volume-converter bg-surface rounded-xl border border-border overflow-hidden">
  {/* Header */}
  <button
    type="button"
    id="volume-toggle"
    class="w-full flex items-center justify-between p-4 text-left hover:bg-cream/50 transition-colors"
    aria-expanded="false"
    aria-controls="volume-content"
  >
    <div class="flex items-center gap-2">
      <svg class="w-5 h-5 text-olive" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
      </svg>
      <span class="font-heading text-lg font-semibold text-text">Volume to Weight Converter</span>
    </div>
    <svg
      id="volume-chevron"
      class="w-5 h-5 text-text-muted transition-transform"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  {/* Content */}
  <div id="volume-content" class="hidden border-t border-border">
    <div class="p-6">
      <p class="text-sm text-text-muted mb-4">
        Convert cups and tablespoons to grams for more accurate measurements.
      </p>

      {/* Converter form */}
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
        {/* Amount */}
        <div>
          <label for="volumeAmount" class="block text-sm font-medium text-text mb-2">Amount</label>
          <select
            id="volumeAmount"
            class="w-full px-3 py-2 bg-cream border border-border rounded-lg text-text focus:outline-none focus:ring-2 focus:ring-olive focus:border-olive"
          >
            <option value="0.25">1/4</option>
            <option value="0.333">1/3</option>
            <option value="0.5">1/2</option>
            <option value="0.667">2/3</option>
            <option value="0.75">3/4</option>
            <option value="1" selected>1</option>
            <option value="1.5">1 1/2</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
        </div>

        {/* Unit */}
        <div>
          <label for="volumeUnit" class="block text-sm font-medium text-text mb-2">Unit</label>
          <select
            id="volumeUnit"
            class="w-full px-3 py-2 bg-cream border border-border rounded-lg text-text focus:outline-none focus:ring-2 focus:ring-olive focus:border-olive"
          >
            <option value="cup" selected>cup</option>
            <option value="tbsp">tablespoon</option>
            <option value="tsp">teaspoon</option>
          </select>
        </div>

        {/* Ingredient */}
        <div>
          <label for="volumeIngredient" class="block text-sm font-medium text-text mb-2">Ingredient</label>
          <select
            id="volumeIngredient"
            class="w-full px-3 py-2 bg-cream border border-border rounded-lg text-text focus:outline-none focus:ring-2 focus:ring-olive focus:border-olive"
          >
            <optgroup label="Flours">
              {flourIngredients.map(i => (
                <option value={i.id}>{i.name}</option>
              ))}
            </optgroup>
            <optgroup label="Other Ingredients">
              {otherIngredients.map(i => (
                <option value={i.id}>{i.name}</option>
              ))}
            </optgroup>
          </select>
        </div>
      </div>

      {/* Result */}
      <div class="bg-olive/10 rounded-lg p-4 text-center">
        <span class="text-sm text-text-muted">Equals:</span>
        <div class="text-3xl font-bold text-olive" id="volumeResult">125g</div>
      </div>

      {/* Quick reference table */}
      <div class="mt-6">
        <h4 class="text-sm font-medium text-text mb-3">Quick Reference (grams per cup)</h4>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm">
          <div class="flex justify-between p-2 bg-cream rounded">
            <span class="text-text-muted">AP Flour</span>
            <span class="font-mono font-medium text-text">125g</span>
          </div>
          <div class="flex justify-between p-2 bg-cream rounded">
            <span class="text-text-muted">Bread Flour</span>
            <span class="font-mono font-medium text-text">127g</span>
          </div>
          <div class="flex justify-between p-2 bg-cream rounded">
            <span class="text-text-muted">00 Flour</span>
            <span class="font-mono font-medium text-text">115g</span>
          </div>
          <div class="flex justify-between p-2 bg-cream rounded">
            <span class="text-text-muted">Water</span>
            <span class="font-mono font-medium text-text">237g</span>
          </div>
          <div class="flex justify-between p-2 bg-cream rounded">
            <span class="text-text-muted">Sugar</span>
            <span class="font-mono font-medium text-text">200g</span>
          </div>
          <div class="flex justify-between p-2 bg-cream rounded">
            <span class="text-text-muted">Olive Oil</span>
            <span class="font-mono font-medium text-text">216g</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  import { VOLUME_CONVERSIONS, cupsToGrams, tbspToGrams, tspToGrams } from '../../scripts/features/volumeConverter.js';

  // Toggle panel
  const toggleBtn = document.getElementById('volume-toggle');
  const content = document.getElementById('volume-content');
  const chevron = document.getElementById('volume-chevron');

  toggleBtn?.addEventListener('click', () => {
    const isExpanded = toggleBtn.getAttribute('aria-expanded') === 'true';
    toggleBtn.setAttribute('aria-expanded', (!isExpanded).toString());
    content?.classList.toggle('hidden');
    chevron?.classList.toggle('rotate-180');
  });

  // Converter logic
  const amountSelect = document.getElementById('volumeAmount');
  const unitSelect = document.getElementById('volumeUnit');
  const ingredientSelect = document.getElementById('volumeIngredient');
  const resultDisplay = document.getElementById('volumeResult');

  function updateResult() {
    const amount = parseFloat(amountSelect?.value || '1');
    const unit = unitSelect?.value || 'cup';
    const ingredientId = ingredientSelect?.value || 'allPurposeFlour';

    let grams = 0;

    switch (unit) {
      case 'cup':
        grams = cupsToGrams(amount, ingredientId) || 0;
        break;
      case 'tbsp':
        grams = tbspToGrams(amount, ingredientId) || 0;
        break;
      case 'tsp':
        grams = tspToGrams(amount, ingredientId) || 0;
        break;
    }

    if (resultDisplay) {
      resultDisplay.textContent = `${Math.round(grams * 10) / 10}g`;
    }
  }

  amountSelect?.addEventListener('change', updateResult);
  unitSelect?.addEventListener('change', updateResult);
  ingredientSelect?.addEventListener('change', updateResult);

  // Initial calculation
  updateResult();
</script>
