---
/**
 * StyleSelector Component
 * Radio card grid for selecting pizza style
 * Single 3-column grid with Custom as full-width featured option
 */
import { PIZZA_STYLES, getAllStyles } from '../../scripts/calculator/presets.js';
import PizzaStyleIcon from '../icons/PizzaStyleIcon.astro';

const styles = getAllStyles();
// Main styles (6) + Custom separate
const mainStyles = styles.filter(s => s.id !== 'custom');
const customStyle = styles.find(s => s.id === 'custom');
---

<div class="style-selector">
  <h2 class="font-heading text-2xl font-bold text-text mb-2">
    Choose Your Style
  </h2>
  <p class="text-text-muted mb-6">
    Select a style for recommended settings, or go custom.
  </p>

  <div class="flex flex-col gap-4" role="radiogroup" aria-label="Pizza style selection">
    <!-- Main styles: 3-column grid -->
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
      {mainStyles.map((style, index) => (
        <label
          class={`style-card group relative flex flex-col p-4 bg-surface border border-border/60 rounded-xl cursor-pointer transition-all duration-200 hover:border-ember/40 hover:shadow-md hover:-translate-y-0.5 focus-within:ring-2 focus-within:ring-ember focus-within:ring-offset-2 animate-fade-in stagger-${index + 1}`}
          data-style={style.id}
        >
          <input
            type="radio"
            name="pizzaStyle"
            value={style.id}
            class="sr-only peer"
            checked={index === 0}
          />

          {/* Selected indicator */}
          <div class="absolute -top-1.5 -right-1.5 w-6 h-6 rounded-full border-2 border-white bg-border peer-checked:bg-ember shadow-sm transition-all duration-200 flex items-center justify-center">
            <svg class="checkmark-icon w-3 h-3 text-white opacity-0 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
          </div>

          {/* Style name and icon inline */}
          <div class="flex items-center gap-2 mb-2">
            <div class="flex-shrink-0 w-7 h-7 flex items-center justify-center rounded-lg bg-ember/10 group-hover:bg-ember/15 transition-colors">
              <PizzaStyleIcon name={style.icon} class="w-3.5 h-3.5 text-ember" />
            </div>
            <h3 class="font-heading font-bold text-sm text-char leading-tight">{style.name}</h3>
          </div>

          {/* Description */}
          <p class="text-xs text-char-soft leading-relaxed flex-grow">{style.description}</p>

          {/* Equipment hint - hidden on mobile */}
          <p class="hidden md:block text-[11px] text-char-soft/50 italic mt-2 pt-2 border-t border-border/30">{style.equipment}</p>

          {/* Selected state: left accent bar */}
          <div class="absolute left-0 top-3 bottom-3 w-0.5 rounded-full bg-ember opacity-0 peer-checked:opacity-100 transition-opacity" />
        </label>
      ))}
    </div>

    {/* Custom option - full width featured card */}
    {customStyle && (
      <label
        class="style-card-custom group relative flex items-center gap-4 p-4 bg-char/[0.03] border border-dashed border-char/20 rounded-xl cursor-pointer transition-all duration-200 hover:border-ember/40 hover:bg-ember/[0.02] focus-within:ring-2 focus-within:ring-ember focus-within:ring-offset-2 animate-fade-in stagger-7"
        data-style={customStyle.id}
      >
        <input
          type="radio"
          name="pizzaStyle"
          value={customStyle.id}
          class="sr-only peer"
        />

        {/* Icon */}
        <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-xl bg-char/5 group-hover:bg-ember/10 transition-colors">
          <PizzaStyleIcon name={customStyle.icon} class="w-5 h-5 text-char-soft group-hover:text-ember transition-colors" />
        </div>

        {/* Content */}
        <div class="flex-grow">
          <h3 class="font-heading font-bold text-sm text-char">{customStyle.name}</h3>
          <p class="text-xs text-char-soft">{customStyle.description}</p>
        </div>

        {/* Selected indicator */}
        <div class="flex-shrink-0 w-6 h-6 rounded-full border-2 border-char/20 peer-checked:border-ember peer-checked:bg-ember transition-all duration-200 flex items-center justify-center">
          <svg class="checkmark-icon w-3 h-3 text-white opacity-0 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
        </div>
      </label>
    )}
  </div>
</div>

<style>
  /* Card selected state */
  .style-card:has(input:checked) {
    border-color: var(--color-ember);
    background: linear-gradient(135deg,
      color-mix(in srgb, var(--color-ember) 3%, var(--color-surface)) 0%,
      var(--color-surface) 100%
    );
    box-shadow: 0 2px 12px -4px rgba(217, 93, 57, 0.15);
  }

  .style-card-custom:has(input:checked) {
    border-color: var(--color-ember);
    border-style: solid;
    background: linear-gradient(135deg,
      color-mix(in srgb, var(--color-ember) 3%, var(--color-surface)) 0%,
      var(--color-surface) 100%
    );
  }

  /* Checkmark visibility */
  .style-card:has(input:checked) .checkmark-icon,
  .style-card-custom:has(input:checked) .checkmark-icon {
    opacity: 1;
  }

  /* Card base styles */
  .style-card {
    min-height: 100px;
    overflow: visible;
  }

  @media (min-width: 768px) {
    .style-card {
      min-height: 140px;
    }
  }

  /* Remove hover lift on selected */
  .style-card:has(input:checked):hover,
  .style-card-custom:has(input:checked):hover {
    transform: translateY(0);
  }
</style>
